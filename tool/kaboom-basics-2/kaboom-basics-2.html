<!DOCTYPE html>
<html>
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
        <style>
            /* CSS */

        </style>

        <title>Title</title>
    </head>
    <body>
        <!-- HTML -->


        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script type="module">
            // JS

            // import kaboom.js
            import kaboom from "https://unpkg.com/kaboom@3000.0.1/dist/kaboom.mjs";

            // initialize context
            kaboom();

            const JUMP_FORCE = 800;
            const SPEED = 480;
            const MOVE_SPEED = 800;

            scene("game", () => {

                loadSprite("player", "sprites/stickman.png");
                loadSprite("ground", "sprites/grass-block.png");
                loadSprite("coin", "sprites/goldcoin.jpg");

                setGravity(1600);

                const player = add([
                    sprite("player"),
                    area(),
                    body(),
                    scale(0.1),
                    pos(200, 100),
                ])

                addLevel([
                    "                           ",
                    "                           ",
                    "                           ",
                    "            ===            ",
                    "                           ",
                    "                           ",
                    "===========================",
                ], {
                    //define the size of tile block
                    tileWidth: 100,
                    tileHeight: 160,
                    // define what each symbol means, by a function returning a component list (what will be passed to add())
                    tiles: {
                        "=": () => [
                            sprite("ground"),
                            area(),
                            scale(.20),
                            body({ isStatic: true }),
                            pos(-600,-0)
                        ],
                    }
                })
                function jump() {
                    if (player.isGrounded()) {
                        player.jump(JUMP_FORCE);
                    }
                }
                function moveLeft() {
                    player.move(-MOVE_SPEED, 0); // Move left along the x-axis
                    };
                function moveRight() {
                    player.move(MOVE_SPEED, 0); // Move left along the x-axis
                    };

                onKeyPress("space", jump); // jump when user presses space
                onKeyPress("w", jump); // jump when user presses w
                onKeyPress("a", moveLeft); // move left when user presses a
                onKeyPress("d", moveRight); // move right when user presses d
                onClick(jump);

                // Add some coins to the scene
                for (let i = 0; i < 5; i++) {
                    add([
                        sprite("coin"),
                        pos(rand(0, width()), rand(0, height() / 2)),
                        area(),
                        scale(.1),
                        "coin",
                    ]);
                }


                // Get all coins
                const allCoins = get("coin");
                const allCoinsText = add([
                    text(`There are ` + allCoins.length + ` coins in the scene.`),
                    pos(20,100),
                    fixed(),
                ])

                var totalCoins = 0;
                const coinText = add([
                    text("Coins: " + totalCoins),
                    pos(20, 20),
                    fixed(),
                ])
                // Take the coin off of the screen if player touches it
                player.onCollide("coin", (coin) => {
                    destroy(coin);
                    totalCoins++;
                    coinText.text = "Coins: " + totalCoins;
                });

            });

            go("game");
        </script>
    </body>
</html>
